<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Tracker — Blake Corbit</title>
    <meta name="robots" content="noindex, nofollow">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='12' fill='%230a0a0a'/><text x='50' y='68' font-family='monospace' font-size='60' font-weight='bold' fill='%237a8c5e' text-anchor='middle'>bc</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <style>
        /* Password gate */
        #gate {
            min-height: 80vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #gate form {
            text-align: center;
        }
        #gate input[type="password"] {
            font-family: var(--font-mono);
            font-size: 0.875rem;
            padding: 0.6rem 1rem;
            border: 1px solid var(--border);
            background: var(--dark);
            color: var(--white);
            border-radius: 4px;
            width: 240px;
            outline: none;
        }
        #gate input[type="password"]:focus {
            border-color: var(--accent);
        }
        #gate button {
            font-family: var(--font-mono);
            font-size: 0.8125rem;
            padding: 0.6rem 1.25rem;
            border: 1px solid var(--accent);
            background: transparent;
            color: var(--accent);
            cursor: pointer;
            border-radius: 4px;
            margin-left: 0.5rem;
        }
        #gate button:hover {
            background: var(--accent);
            color: var(--black);
        }
        #gate .error {
            color: #c53030;
            font-family: var(--font-mono);
            font-size: 0.75rem;
            margin-top: 0.75rem;
        }

        /* Dashboard */
        #dashboard { display: none; }

        .dash-header {
            background: var(--black);
            padding: 3rem 0 2rem;
        }
        .dash-header h1 {
            color: var(--pure-white);
            font-size: 1.75rem;
            margin-bottom: 0.5rem;
        }
        .dash-header .meta {
            color: var(--light-gray);
        }

        .dash-stats {
            display: flex;
            gap: 2rem;
            padding: 1.5rem 0;
            flex-wrap: wrap;
        }
        .stat {
            text-align: center;
        }
        .stat .num {
            font-family: var(--font-mono);
            font-size: 1.75rem;
            font-weight: 700;
            color: #2d3748;
        }
        .stat .label {
            font-family: var(--font-mono);
            font-size: 0.7rem;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 0.08em;
        }

        .dash-filters {
            display: flex;
            gap: 0.75rem;
            padding: 1rem 0;
            flex-wrap: wrap;
        }
        .filter-btn {
            font-family: var(--font-mono);
            font-size: 0.75rem;
            padding: 0.35rem 0.75rem;
            border: 1px solid var(--border);
            background: transparent;
            color: var(--gray);
            cursor: pointer;
            border-radius: 3px;
        }
        .filter-btn.active {
            border-color: var(--accent);
            color: var(--accent);
        }
        .filter-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
        }

        .job-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }
        .job-table th {
            font-family: var(--font-mono);
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--gray);
            text-align: left;
            padding: 0.5rem 0.75rem;
            border-bottom: 1px solid var(--off-white);
        }
        .job-table td {
            font-size: 0.85rem;
            padding: 0.6rem 0.75rem;
            border-bottom: 1px solid #f0f0f0;
            color: #4a5568;
        }
        .job-table tr:hover td {
            background: #fafafa;
        }
        .job-table .score {
            font-family: var(--font-mono);
            font-weight: 600;
            color: #2d3748;
        }
        .job-table .title-link {
            color: #2d3748;
            font-weight: 500;
            text-decoration: none;
        }
        .job-table .title-link:hover {
            color: var(--accent);
        }
        .job-table .source-tag {
            font-family: var(--font-mono);
            font-size: 0.65rem;
            padding: 0.15rem 0.4rem;
            border-radius: 2px;
            background: #f0f0f0;
            color: var(--gray);
        }
        .job-table .status-badge {
            font-family: var(--font-mono);
            font-size: 0.65rem;
            padding: 0.15rem 0.4rem;
            border-radius: 2px;
        }
        .status-new { background: #ebf8ff; color: #2b6cb0; }
        .status-applied { background: #f0fff4; color: #276749; }
        .status-skipped { background: #f7f7f7; color: #999; }

        /* Follow-up alerts */
        .followup-banner {
            background: #fffbeb;
            border: 1px solid #f6e05e;
            border-radius: 4px;
            padding: 1rem 1.25rem;
            margin: 1rem 0;
            font-family: var(--font-mono);
            font-size: 0.8rem;
        }
        .followup-banner .banner-title {
            font-weight: 600;
            color: #975a16;
            margin-bottom: 0.5rem;
        }
        .followup-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.3rem 0;
            color: #744210;
        }
        .followup-item .days {
            font-weight: 600;
            color: #c53030;
        }
        .followup-item .days.urgent { color: #c53030; }
        .followup-item .days.soon { color: #975a16; }

        /* Match rate bar */
        .match-bar {
            display: inline-block;
            width: 48px;
            height: 6px;
            background: #e2e8f0;
            border-radius: 3px;
            overflow: hidden;
            vertical-align: middle;
            margin-right: 4px;
        }
        .match-bar-fill {
            height: 100%;
            border-radius: 3px;
        }
        .match-high { background: #48bb78; }
        .match-mid { background: #ecc94b; }
        .match-low { background: #fc8181; }
        .match-text {
            font-family: var(--font-mono);
            font-size: 0.7rem;
            color: var(--gray);
        }

        /* Expandable row */
        .job-detail-row td {
            padding: 0.75rem 1rem;
            background: #fafbfc;
            border-bottom: 1px solid #e2e8f0;
        }
        .job-detail-inner {
            display: flex;
            gap: 2rem;
            flex-wrap: wrap;
            font-size: 0.8rem;
        }
        .detail-col { flex: 1; min-width: 200px; }
        .detail-col h4 {
            font-family: var(--font-mono);
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.08em;
            color: var(--gray);
            margin-bottom: 0.4rem;
        }
        .skill-tag {
            display: inline-block;
            font-family: var(--font-mono);
            font-size: 0.65rem;
            padding: 0.1rem 0.35rem;
            border-radius: 2px;
            margin: 0.1rem;
        }
        .skill-have { background: #c6f6d5; color: #276749; }
        .skill-miss { background: #fed7d7; color: #9b2c2c; }

        /* Apply button */
        .apply-btn {
            font-family: var(--font-mono);
            font-size: 0.65rem;
            padding: 0.2rem 0.5rem;
            border: 1px solid var(--accent);
            background: transparent;
            color: var(--accent);
            cursor: pointer;
            border-radius: 2px;
            text-decoration: none;
        }
        .apply-btn:hover {
            background: var(--accent);
            color: var(--black);
        }

        .job-table tr.expandable { cursor: pointer; }
        .job-table tr.expandable:hover td { background: #f7fafc; }

        .no-jobs {
            font-family: var(--font-mono);
            font-size: 0.875rem;
            color: var(--gray);
            padding: 3rem 0;
            text-align: center;
        }

        .dash-content {
            padding: 1rem 0 4rem;
        }

        @media (max-width: 768px) {
            .job-table { font-size: 0.8rem; }
            .job-table th:nth-child(4),
            .job-table td:nth-child(4),
            .job-table th:nth-child(5),
            .job-table td:nth-child(5),
            .job-table th:nth-child(6),
            .job-table td:nth-child(6) { display: none; }
        }
    </style>
</head>
<body>
    <nav>
        <div class="nav-inner">
            <a href="index.html" class="name">blake corbit</a>
            <ul>
                <li><a href="resume.html">resume</a></li>
                <li><a href="projects.html">projects</a></li>
                <li><a href="about.html">about</a></li>
            </ul>
        </div>
    </nav>

    <!-- Password Gate -->
    <div id="gate">
        <form onsubmit="return unlock()">
            <div style="font-family: var(--font-mono); font-size: 0.8125rem; color: var(--gray); margin-bottom: 1rem;">enter password</div>
            <div>
                <input type="password" id="pw" autocomplete="off" autofocus>
                <button type="submit">go</button>
            </div>
            <div id="pw-error" class="error" style="display:none">wrong password</div>
        </form>
    </div>

    <!-- Dashboard (hidden until authenticated) -->
    <div id="dashboard">
        <section class="dash-header">
            <div class="page-width--wide">
                <h1>job tracker</h1>
                <div class="meta" id="last-updated"></div>
            </div>
        </section>

        <section class="dash-content">
            <div class="page-width--wide">
                <div class="dash-stats" id="stats"></div>

                <div id="followup-banner" class="followup-banner" style="display:none"></div>

                <div class="dash-filters">
                    <button class="filter-btn active" data-filter="new" onclick="setFilter('new')">new</button>
                    <button class="filter-btn" data-filter="applied" onclick="setFilter('applied')">applied</button>
                    <button class="filter-btn" data-filter="followup" onclick="setFilter('followup')">follow up</button>
                    <button class="filter-btn" data-filter="skipped" onclick="setFilter('skipped')">skipped</button>
                    <button class="filter-btn" data-filter="all" onclick="setFilter('all')">all</button>
                </div>

                <table class="job-table">
                    <thead>
                        <tr>
                            <th>score</th>
                            <th>title</th>
                            <th>company</th>
                            <th>match</th>
                            <th>salary</th>
                            <th>source</th>
                            <th>status</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody id="job-list"></tbody>
                </table>

                <div id="no-jobs" class="no-jobs" style="display:none">
                    no jobs found. run <code>node hunt.js search</code> locally to find more.
                </div>
            </div>
        </section>
    </div>

    <footer>
        <div class="footer-inner">
            <span class="left">blake corbit — 2026</span>
            <div class="right">
                <a href="mailto:Blake.A.Corbit@gmail.com">email</a>
                <a href="https://linkedin.com/in/blake-corbit" target="_blank">linkedin</a>
                <a href="https://github.com/ApollosTable" target="_blank">github</a>
            </div>
        </div>
    </footer>

    <script>
    // Simple password hash check (SHA-256)
    // Not truly secure — just keeps casual visitors out
    const HASH = '32b92e917c14e39292c72bbc4251e4937b4c249a9e18aaea6d48c9fda02706ca';
    let jobs = [];
    let currentFilter = 'new';

    async function sha256(str) {
        const buf = await crypto.subtle.digest('SHA-256',
            new TextEncoder().encode(str));
        return Array.from(new Uint8Array(buf))
            .map(b => b.toString(16).padStart(2, '0')).join('');
    }

    async function unlock() {
        const pw = document.getElementById('pw').value;
        const hash = await sha256(pw);
        if (hash === HASH) {
            localStorage.setItem('jt_auth', hash);
            showDashboard();
        } else {
            document.getElementById('pw-error').style.display = 'block';
        }
        return false;
    }

    async function checkAuth() {
        const stored = localStorage.getItem('jt_auth');
        if (stored === HASH) {
            showDashboard();
        }
    }

    async function showDashboard() {
        document.getElementById('gate').style.display = 'none';
        document.getElementById('dashboard').style.display = 'block';
        await loadJobs();
    }

    async function loadJobs() {
        try {
            const res = await fetch('data/jobs.json');
            jobs = await res.json();
            jobs.sort((a, b) => b.score - a.score);
            renderStats();
            renderJobs();
        } catch {
            document.getElementById('no-jobs').style.display = 'block';
        }
    }

    function daysSince(dateStr) {
        if (!dateStr) return 0;
        return Math.floor((Date.now() - new Date(dateStr).getTime()) / (1000 * 60 * 60 * 24));
    }

    function renderStats() {
        const stats = { total: jobs.length, new: 0, applied: 0, skipped: 0 };
        const sources = {};
        let needFollowup = 0;
        jobs.forEach(j => {
            stats[j.status] = (stats[j.status] || 0) + 1;
            sources[j.source] = (sources[j.source] || 0) + 1;
            if (j.status === 'applied' && j.appliedDate && daysSince(j.appliedDate) >= 5) needFollowup++;
        });

        const dates = jobs.map(j => j.foundDate).filter(Boolean).sort();
        const latest = dates[dates.length - 1] || 'never';
        document.getElementById('last-updated').textContent = `last search: ${latest}`;

        document.getElementById('stats').innerHTML = `
            <div class="stat"><div class="num">${stats.total}</div><div class="label">total</div></div>
            <div class="stat"><div class="num">${stats.new}</div><div class="label">new</div></div>
            <div class="stat"><div class="num">${stats.applied}</div><div class="label">applied</div></div>
            <div class="stat"><div class="num">${stats.skipped}</div><div class="label">skipped</div></div>
            ${needFollowup > 0 ? `<div class="stat"><div class="num" style="color:#c53030">${needFollowup}</div><div class="label">follow up</div></div>` : ''}
            ${Object.entries(sources).map(([s, c]) =>
                `<div class="stat"><div class="num">${c}</div><div class="label">${s}</div></div>`
            ).join('')}
        `;

        // Follow-up banner
        const banner = document.getElementById('followup-banner');
        const followups = jobs
            .filter(j => j.status === 'applied' && j.appliedDate && daysSince(j.appliedDate) >= 5)
            .sort((a, b) => daysSince(b.appliedDate) - daysSince(a.appliedDate));

        if (followups.length > 0) {
            banner.style.display = 'block';
            banner.innerHTML = `
                <div class="banner-title">follow up needed (${followups.length})</div>
                ${followups.map(j => {
                    const d = daysSince(j.appliedDate);
                    const cls = d >= 14 ? 'urgent' : 'soon';
                    return `<div class="followup-item">
                        <span>${esc(j.title)} @ ${esc(j.company)}</span>
                        <span class="days ${cls}">${d}d ago</span>
                    </div>`;
                }).join('')}
            `;
        } else {
            banner.style.display = 'none';
        }
    }

    function setFilter(filter) {
        currentFilter = filter;
        document.querySelectorAll('.filter-btn').forEach(b => {
            b.classList.toggle('active', b.dataset.filter === filter);
        });
        renderJobs();
    }

    function matchBar(gaps) {
        if (!gaps || !gaps.matchRate && gaps.matchRate !== 0) return '<span class="match-text">—</span>';
        const rate = gaps.matchRate;
        const cls = rate >= 70 ? 'match-high' : rate >= 40 ? 'match-mid' : 'match-low';
        return `<span class="match-bar"><span class="match-bar-fill ${cls}" style="width:${rate}%"></span></span><span class="match-text">${rate}%</span>`;
    }

    function renderGapDetail(gaps) {
        if (!gaps || !gaps.jobWants || gaps.jobWants.length === 0) {
            return '<em style="color:var(--gray);font-size:0.75rem">no skill data available</em>';
        }
        const matched = (gaps.matched || []).map(s => `<span class="skill-tag skill-have">${esc(s)}</span>`).join('');
        const missing = (gaps.missing || []).map(s => `<span class="skill-tag skill-miss">${esc(s)}</span>`).join('');
        return `<div class="job-detail-inner">
            ${matched ? `<div class="detail-col"><h4>skills you have</h4>${matched}</div>` : ''}
            ${missing ? `<div class="detail-col"><h4>gaps to address</h4>${missing}</div>` : ''}
        </div>`;
    }

    function toggleDetail(id) {
        const row = document.getElementById('detail-' + id);
        if (row) {
            row.style.display = row.style.display === 'none' ? 'table-row' : 'none';
        }
    }

    function renderJobs() {
        let filtered;
        if (currentFilter === 'all') {
            filtered = jobs;
        } else if (currentFilter === 'followup') {
            filtered = jobs.filter(j => j.status === 'applied' && j.appliedDate && daysSince(j.appliedDate) >= 5);
        } else {
            filtered = jobs.filter(j => j.status === currentFilter);
        }

        const tbody = document.getElementById('job-list');

        if (filtered.length === 0) {
            tbody.innerHTML = '';
            document.getElementById('no-jobs').style.display = 'block';
            return;
        }

        document.getElementById('no-jobs').style.display = 'none';
        tbody.innerHTML = filtered.map((j, i) => {
            const rowId = `row-${i}`;
            const followupInfo = j.status === 'applied' && j.appliedDate
                ? ` (${daysSince(j.appliedDate)}d)` : '';
            return `
            <tr class="expandable" onclick="toggleDetail('${rowId}')">
                <td class="score">${j.score}</td>
                <td>${j.url
                    ? `<a href="${j.url}" target="_blank" class="title-link" onclick="event.stopPropagation()">${esc(j.title)}</a>`
                    : esc(j.title)}</td>
                <td>${esc(j.company)}</td>
                <td>${matchBar(j.gaps)}</td>
                <td>${esc(j.salary || '—')}</td>
                <td><span class="source-tag">${j.source}</span></td>
                <td><span class="status-badge status-${j.status}">${j.status}${followupInfo}</span></td>
                <td>${j.url ? `<a href="${j.url}" target="_blank" class="apply-btn" onclick="event.stopPropagation()">apply</a>` : ''}</td>
            </tr>
            <tr class="job-detail-row" id="detail-${rowId}" style="display:none">
                <td colspan="8">${renderGapDetail(j.gaps)}</td>
            </tr>`;
        }).join('');
    }

    function esc(str) {
        const d = document.createElement('div');
        d.textContent = str;
        return d.innerHTML;
    }

    checkAuth();
    </script>
</body>
</html>
